<div class="container-fluid">
	<app-page-title title="Nouveau Livreur" [breadcrumbItems]="breadCrumbItems"></app-page-title>

	<div class="row">
		<div class="col-12">
			<div class="card">
				<div class="card-body">
					<form [formGroup]="form" (ngSubmit)="submit()" novalidate>
						<div class="row g-3">
											<div class="col-md-6">
												<label class="form-label" for="name">Nom</label>
												<input id="name" class="form-control" formControlName="name" placeholder="Nom complet">
											</div>
											<div class="col-md-6">
												<label class="form-label" for="displayName">Nom d'affichage</label>
												<input id="displayName" class="form-control" formControlName="displayName" placeholder="Affiché dans l'UI">
											</div>

											<div class="col-md-6">
												<label class="form-label" for="phone">Téléphone</label>
												<input id="phone" class="form-control" formControlName="phone" placeholder="Tél">
											</div>
											<div class="col-md-6">
												<label class="form-label" for="email">Email</label>
												<input id="email" class="form-control" formControlName="email" placeholder="email@exemple.com">
											</div>

											<div class="col-md-6">
												<label class="form-label" for="vehicle">Véhicule</label>
												<input id="vehicle" class="form-control" formControlName="vehicle" placeholder="Ex: 123 تونس 4567">
											</div>
											<div class="col-md-6">
												<label class="form-label" for="cin">CIN</label>
												<input id="cin" class="form-control" formControlName="cin" placeholder="Numéro CIN">
											</div>

							<div class="col-12">
								<label class="form-label" for="zones">Villes desservies</label>
								<ng-select id="zones"
										   [items]="cities"
										   [multiple]="true"
										   [closeOnSelect]="false"
										   bindLabel=""
										   placeholder="Choisir des villes"
										   formControlName="zones">
								</ng-select>
								<div class="form-text">Choisissez une ou plusieurs villes de Tunisie.</div>
							</div>

							<div class="col-12">
								<div class="form-check form-switch">
									<input class="form-check-input" type="checkbox" id="activeSwitch" formControlName="active">
									<label class="form-check-label" for="activeSwitch">Actif</label>
								</div>
							</div>

							<div class="col-12">
								<div class="form-check form-switch">
									<input class="form-check-input" type="checkbox" id="createAccountSwitch" formControlName="createAccount">
									<label class="form-check-label" for="createAccountSwitch">Créer un compte utilisateur</label>
								</div>
								<div class="form-text">Un compte utilisateur permettra au livreur de se connecter à l'application mobile.</div>
								<div class="form-text text-warning" *ngIf="f['createAccount'].value">
									⚠️ L'email est requis pour créer un compte utilisateur.
								</div>
							</div>

							<!-- Password options - shown when createAccount is enabled -->
							<div class="col-12" *ngIf="f['createAccount'].value">
								<div class="card bg-light border-0 mt-2">
									<div class="card-body">
										<h6 class="card-title mb-3">
											<i class="fas fa-key me-2"></i>Configuration du mot de passe
										</h6>

										<div class="form-check form-switch mb-3">
											<input class="form-check-input" type="checkbox" id="useAdminPasswordSwitch" formControlName="useAdminPassword">
											<label class="form-check-label" for="useAdminPasswordSwitch">
												Définir un mot de passe personnalisé
											</label>
										</div>

										<div *ngIf="f['useAdminPassword'].value" class="mb-3">
											<label class="form-label" for="adminPassword">Mot de passe</label>
											<div class="input-group">
												<input id="adminPassword"
													   type="text"
													   class="form-control"
													   formControlName="adminPassword"
													   placeholder="Minimum 6 caractères"
													   minlength="6">
												<button class="btn btn-outline-secondary" type="button"
														(click)="generatePassword()"
														title="Générer un mot de passe">
													<i class="fas fa-sync-alt"></i>
												</button>
											</div>
											<div class="form-text">
												Ce mot de passe sera communiqué directement au livreur par l'admin.
											</div>
										</div>

										<div *ngIf="!f['useAdminPassword'].value" class="alert alert-info mb-0">
											<i class="fas fa-info-circle me-2"></i>
											Un mot de passe sera généré automatiquement et un email de réinitialisation sera envoyé à l'adresse indiquée.
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="text-end mt-4">
							<a class="btn btn-light me-2" [routerLink]="['/megafast/drivers']">Annuler</a>
											<button class="btn btn-primary" type="submit" [disabled]="form.invalid || saving">
												<span *ngIf="saving" class="spinner-border spinner-border-sm me-2" aria-live="polite"></span>
								Enregistrer
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
